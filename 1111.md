import { useState } from "react";
import PkgBasicParts from "../../../common/PkgBasicParts";
import PkgKakuchoParts from "../../../common/PkgKakuchoParts";
import { BaseDialogProps, ButtonOnClickEvent } from "../../../common/PkgType";
import PkgGlobal from "../../../conf/PkgGlobal";
import MockupJson from "../../../mockup/300000/316/DlgG316020040_07.json";


const DlgG316020040_07 = {
  Dialog: ({ props }: DlgG316020040_07Props) => {
    const [form, setForm] = useState({
      txfTekiokubun: "",
      lblTekiokubun_nm1: "",
      txfSetubisaibun_nm: "",
      lblTekionendo1: ""
    });

    /**
     * モックアップ用
     */
    const mockup = () => {
      PkgKakuchoParts.setDialogTitle("1.0", "G316020040_07");
      setForm(MockupJson.form);
    };

    /**
     * @[概要]表示時イベント
     */
    const onShow = async () => {
      PkgKakuchoParts.setDialogTitle("1.0", "G316020040_07");
    };

    /**
     * @[概要] OKボタン押下
     * @param {ButtonOnClickEvent} ev
     */
    const btnOKOnClick = (ev: ButtonOnClickEvent) => {
      props.setShow(false);
    };

    // フッターボタン群
    const footerButtons = [
      { id: "btnOKG316020040_07", text: "Ｏ　Ｋ", onClick: btnOKOnClick }
    ];

    return (
      <PkgKakuchoParts.ClsDialog show={props.show} onShow={PkgGlobal.MOCKUP_MODE ? mockup : onShow}>
        <PkgKakuchoParts.ClsDialogHeader title="優遇税制参照" />
        <PkgKakuchoParts.ClsDialogMain>
          <div className="row">
            <span className="form-item">
              {/* 適応区分 */}
              <PkgBasicParts.ClsBaseLabel
                id="lblTekiokubun"
                value="適応区分:&nbsp"
                width={PkgBasicParts.getWidth.Label(14)}
              />
              <PkgBasicParts.ClsBaseEditBox
                name="txfTekiokubun"
                value={form.txfTekiokubun}
                width={PkgBasicParts.getWidth.EditBox(70)}
                height={PkgBasicParts.getHeight.EditBox(2)}
                maxLength={140}
                overflowYScroll={false}
                readOnly={true}
                style={{
                  border: "none",
                  backgroundColor: "transparent",
                  outline: "none",
                  boxShadow: "none",
                  marginTop: "-1px",
                  marginLeft: "-2px"
                }}
              />
            </span>
          </div>
          <div className="row">
            <span className="form-item">
              {/* 適応区分名称 */}
              <PkgBasicParts.ClsBaseLabel
                id="lblTekiokubun_nm"
                value="適応区分名称:&nbsp"
                width={PkgBasicParts.getWidth.Label(14)}
              />
              <PkgBasicParts.ClsBaseLabel
                id="lblTekiokubun_nm1"
                value={form.lblTekiokubun_nm1}
                width={PkgBasicParts.getWidth.Label(70)}
                style={{textAlign: "left"}}
              />
            </span>
          </div>
          <div className="row">
            <span className="form-item">
              {/* 設備細分名 */}
              <PkgBasicParts.ClsBaseLabel
                id="lblSetubisaibun_nm"
                value="設備細分名:&nbsp"
                width={PkgBasicParts.getWidth.Label(14)}
              />
              <PkgBasicParts.ClsBaseEditBox
                name="txfSetubisaibun_nm"
                value={form.txfSetubisaibun_nm}
                width={PkgBasicParts.getWidth.EditBox(62)}
                height={PkgBasicParts.getHeight.EditBox(2)}
                maxLength={120}
                overflowYScroll={false}
                readOnly={true}
                style={{
                  border: "none",
                  backgroundColor: "transparent",
                  outline: "none",
                  boxShadow: "none",
                  marginTop: "-1px",
                  marginLeft: "-2px"
                }}
              />
            </span>
          </div>
          <div className="row">
            <span className="form-item">
              {/* 適応年度 */}
              <PkgBasicParts.ClsBaseLabel
                id="lblTekionendo"
                value="適応年度:&nbsp"
                width={PkgBasicParts.getWidth.Label(14)}
              />
              <PkgBasicParts.ClsBaseLabel
                id="lblTekionendo1"
                value={form.lblTekionendo1}
                width={PkgBasicParts.getWidth.Label(62)}
                style={{textAlign: "left"}}
              />
            </span>
          </div>
        </PkgKakuchoParts.ClsDialogMain>
        <PkgKakuchoParts.ClsDialogFooter buttons={footerButtons} />
      </PkgKakuchoParts.ClsDialog>
    );
  }
};

export default DlgG316020040_07;

export type DlgG316020040_07Props = {
  props: BaseDialogProps & {
    // 呼出時に独自のパラメータがある場合に記載
  }
};



---------------------------------------分割线---------------------------------------------------------


import { useEffect, useState } from "react";
import PkgBasicParts from "../../../common/PkgBasicParts";
import PkgHttp, { HttpResponseT } from "../../../common/PkgHttp";
import PkgKakuchoParts from "../../../common/PkgKakuchoParts";
import PkgGlobal from "../../../conf/PkgGlobal";
import { BaseDialogProps, ButtonOnClickEvent } from "../../../common/PkgType";
import MockupJson from "../../../mockup/300000/32Z/DlgG32Z040010_03.json";
import PkgCheck from "../../../common/PkgCheck";
import PkgMessage from "../../../common/PkgMessage";
import PkgScreenControl from "../../../common/PkgScreenControl";





const DlgG32Z040010_03 = {

  Dialog: ({ props }: DlgG32Z040010_03Props) => {
    /** @[概要]: 画面ＩＤ */
    const GID = "G32Z040010_03";
    /** @[概要]: 画面Version */
    const GVER = "1.0";

    // コード一覧
    useEffect(() => {
    }, []);
    const [list, setList] = useState({
      src: [] as string[][],
      selectedIndex: -1,
      setSelectedIndex: (i: number) =>
        setList((l) => ({ ...l, selectedIndex: i })),
    });

    /**
     * モックアップ用
     */
    const mockup = () => {
      PkgKakuchoParts.setDialogTitle(GVER, GID);
      setList((l) => ({ ...l, ...MockupJson.listSearchResult }));
    };
    /**
    * @[概要]入力値の妥当性チェックを行う
    */
    const validate = () => {
      try {
        /* 施工組織コード */
        if (!PkgCheck.chkInput(props.sksCd)) {
          PkgMessage.putMessageBox("NNCW0115", ["施工組織コード"]);
          return false;
        }
        /* 使用不可フラグ */
        if (!PkgCheck.chkInput(props.fukaFlg)) {
          PkgMessage.putMessageBox("NNCW0115", ["使用不可フラグ"]);
          return false;
        }
        /* 呼び出し元フラグ */
        if (!PkgCheck.chkInput(props.yobidasiFlg)) {
          PkgMessage.putMessageBox("NNCW0115", ["呼び出し元フラグ"]);
          return false;
        } else {
          if (props.yobidasiFlg !== "1" && props.yobidasiFlg !== "2") {
            /* 妥当性チェック */
            PkgMessage.putMessageBox("NNCW0133", ["呼び出し元フラグ"]);
            return false;
          }
        }
        /* 項目間妥当性チェック */

        if (props.yobidasiFlg === "2") {
          /* 工通指示の場合以下の項目は必須 */

          /* 工事計画番号 */
          if (!PkgCheck.chkInput(props.kkn)) {
            /* 必須チェック */
            PkgMessage.putMessageBox("NNCW0115", ["工事計画番号"]);
            return false;
          }

          /* 固定資産管理組織コード */
          if (!PkgCheck.chkInput(props.fsikssCd)) {
            /* 必須チェック */
            PkgMessage.putMessageBox("NNCW0115", ["固定資産管理組織コード"]);
            return false;
          }
        }
        return true;
      } catch (e) {
        PkgMessage.putException("e", "onShow");
        // 画面ロック
        PkgScreenControl.lockDialog("btnCancelG32Z040010_03");
        PkgBasicParts.setDisabled("btnOkG32Z040010_03", true);
      } finally {
        // スピナー非表示
        PkgScreenControl.switchLoadingSpinner(false);
      }

    };
    /**
     * @[概要]表示時イベント
     */
    const onShow = async () => {
      try {
        //スピナー表示
        await PkgScreenControl.switchLoadingSpinner(true);
        if (validate() === false) {
          props.setShow(false);
          return;
        }
        //ボタン非活性化
        PkgBasicParts.setDisabled("OkG32Z040010_03btn", true);
        PkgKakuchoParts.setDialogTitle(GVER, GID);
        /* 上り電文設定 */

        const nobori = {
          SKS_CD: props.sksCd,
          KKN: props.kkn,
          FSIKSS_CD: props.fsikssCd,
          FUKA_FLG: props.fukaFlg,
          RKSBMI: props.rksbmi,
          YOBIDASI_FLG: props.yobidasiFlg,
        };
        type kudari_t = {
          RESULT_LIST: string[][];
        };

        //サーバ問い合わせ
        let rslt: HttpResponseT<kudari_t> = {} as HttpResponseT<kudari_t>
        if (props.yobidasiFlg === "1") {
          rslt = await PkgHttp.callGateway("32Z040030", nobori);
        }
        if (props.yobidasiFlg === "2") {
          rslt = await PkgHttp.callGateway("32Z040031", nobori);
        }


        // 処理結果による分岐
        if (rslt.RESULT === "SUCCESS") {
          /* データを取得に成功した場合 */

          // 初期選択レコード
          let selected_index = 0;
          if (props.rksbmi) {
            // 下り電文から一致する行を検索
            rslt.BUSINESS_DATA.RESULT_LIST.forEach((rec: string[], i: number) => {
              if (rec[0] === props.rksbmi) return (selected_index = i);
            });
          }

          // リストを表示
          setList((l) => ({
            ...l,
            src: rslt.BUSINESS_DATA.RESULT_LIST.map((rec: string[]) => [
              rec[0],
              rec[1],
            ]),
            selectedIndex: selected_index,
          }));
          //ボタン活性化
          PkgBasicParts.setDisabled("btnOkG32Z040010_03", false);
        } else if (rslt.RESULT === "BUSINESS_ERROR") {
          // 業務エラーの場合
          const messageId = rslt.MESSAGE_ID;
          if (messageId === "NNCW0007") {
            PkgMessage.putMessageBox(messageId, []);
            PkgBasicParts.setDisabled("btnOkG32Z040010_03", true);
            props.setShow(false);
          }
        } else if (rslt.RESULT === "SYSTEM_ERROR") {
          // システムエラーの場合
          PkgScreenControl.lockDialog("btnCancelG32Z040010_03");
          // ダイアログを閉じる
          props.setShow(false);
        }
      } catch (e) {
        PkgMessage.putException("e", "onShow");
        // 画面ロック
        PkgScreenControl.lockDialog("btnCancelG32Z040010_03");
        PkgBasicParts.setDisabled("btnOkG32Z040010_03", true);
      } finally {
        // スピナー非表示
        PkgScreenControl.switchLoadingSpinner(false);
      }
    };


    /**
     * @[概要]リストが更新されたときにスクロールを選択行に移動
     */
    useEffect(() => {
      // スクロールを選択行に移動（-1にしないとstickyの陰に隠れてしまう）
      (
        document.getElementById("tbG32Z040010_03")?.childNodes[1]?.childNodes[
        list.selectedIndex - 1
        ] as HTMLElement
      )?.scrollIntoView();
    }, [list.src]);

    /**
     * @[概要]OKボタン押下
     * BIL_CD: string; // ビルコード
     * RKSBMI: string; // 略称ビル名
     * @param {*} ev
     */
    const btnOkOnClick = (ev: ButtonOnClickEvent) => {
      try {
        //スピナー表示
        PkgScreenControl.switchLoadingSpinner(true);
        const args = {
          BIL_CD: list.src[list.selectedIndex][0],
          RKSBMI: list.src[list.selectedIndex][1],
        };
        // 呼び出し元のボタン押下イベントを発火
        props.btnOkClickEvent(ev, args);
        // ダイアログを閉じる
        props.setShow(false);
      } catch (e) {
        PkgMessage.putException(e, "btnOkG32Z040010_03OnClick");
      } finally {
        // スピナー非表示
        PkgScreenControl.switchLoadingSpinner(false);
      }
    };

    /**
     * @[概要]キャンセルボタン押下
     * @param {*} ev イベントオブジェクト
     */
    const btnCancelG32Z040010_03OnClick = () => {
      try {
        // ダイアログを閉じる
        props.setShow(false);
      } catch (e) {
        PkgMessage.putException(e, "btnCancelG32Z040010_03OnClick");
        //画面ロック
        PkgScreenControl.lockDialog("btnCancelG32Z040010_03");
      }
    };

    // フッターボタン群
    const footerButtons = [
      { id: "btnOkG32Z040010_03", text: "Ｏ　Ｋ", onClick: btnOkOnClick },
      {
        id: "btnCancelG32Z040010_03",
        text: "キャンセル",
        onClick: btnCancelG32Z040010_03OnClick,
      },
    ];

    return (
      <PkgKakuchoParts.ClsDialog
        show={props.show}
        onShow={PkgGlobal.MOCKUP_MODE ? mockup : onShow}
      >
        <PkgKakuchoParts.ClsDialogHeader title="ビルコード" />
        <PkgKakuchoParts.ClsDialogMain>
          <PkgKakuchoParts.ClsDialogMain>
            <PkgBasicParts.ClsBaseFlexView id="tblG32Z040010_03" height={470}>
              <PkgBasicParts.ClsBaseFlexHeader
                columns={[
                  {
                    width: PkgBasicParts.getWidth.TextBox(10),
                    title: "ビルコード",
                  },
                  {
                    width: PkgBasicParts.getWidth.TextBox(20),
                    title: "略称ビル名",
                  },
                ]}
              />
              <PkgBasicParts.ClsBaseFlexBody
                src={list.src}
                selectedIndex={list.selectedIndex}
                setSelectedIndex={list.setSelectedIndex}
              >
                <PkgBasicParts.ClsBaseFlexLabel valueIndex={0} />
                <PkgBasicParts.ClsBaseFlexLabel valueIndex={1} />
              </PkgBasicParts.ClsBaseFlexBody>
            </PkgBasicParts.ClsBaseFlexView>
          </PkgKakuchoParts.ClsDialogMain>
        </PkgKakuchoParts.ClsDialogMain>

        <PkgKakuchoParts.ClsDialogFooter buttons={footerButtons} />
      </PkgKakuchoParts.ClsDialog>
    );
  },
};
export default DlgG32Z040010_03;

export type DlgG32Z040010_03Props = {
  props: BaseDialogProps & {
    btnOkClickEvent: ButtonOnClickEvent;
    sksCd: string; // 施工組織コード
    fukaFlg: string; // 使用不可フラグ
    rksbmi: string; // 略称ビル名
    yobidasiFlg: string; // 呼び出し元フラグ 1:検索 2工通指示;
    kkn: string; // 工事計画番号 ※工通指示の場合のみ設定可;
    fsikssCd: string; // 固定資産管理組織コード ※工通指示の場合のみ設定可;
  };
};

export type DlgG32Z040010_03Args = {
  BIL_CD: string; // ビルコード
  RKSBMI: string; // 略称ビル名
};





